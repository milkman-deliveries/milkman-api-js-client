import{__rest as t,__awaiter as e}from"tslib";import"isomorphic-fetch";import{clearTimeout as s}from"timers";const i=t=>sessionStorage.setItem("MILMAN_COGNITO_ID_TOKEN",t),o={Accept:"application/json","Content-Type":"application/json"};class r{constructor(t={}){this.baseUrl=t.baseUrl}composeUrl(t){let e="";this.baseUrl&&(e+=this.baseUrl.replace(/\/*$/,""));return e+="/"+t.replace(/^\/*/,""),e}composeHeaders(t={}){return Object.assign(Object.assign(Object.assign({},o),{authorization:"Bearer "+sessionStorage.getItem("MILMAN_COGNITO_ID_TOKEN")}),t)}composeOptions(e,s={}){const{headers:i}=s,o=t(s,["headers"]);return Object.assign({method:e,headers:this.composeHeaders(i)},o)}fetch(t,e,s){return fetch(this.composeUrl(e),this.composeOptions(t,s))}get(t,e){this.fetch("GET",t,e)}post(t,e,s){this.fetch("POST",t,Object.assign({body:JSON.stringify(e)},s))}put(t,e,s){this.fetch("PUT",t,Object.assign({body:JSON.stringify(e)},s))}patch(t,e,s){this.fetch("PATCH",t,Object.assign({body:JSON.stringify(e)},s))}delete(t,e){this.fetch("DELETE",t,e)}}const n="https://auth.milkmantechnologies.com/",h=33e5;var c,a,u;!function(t){t.USER_PASSWORD="USER_PASSWORD_AUTH",t.REFRESH_TOKEN="REFRESH_TOKEN_AUTH"}(c||(c={}));class l{constructor(t){this.application=t.application,this.clientId=t.clientId,this.automaticRefresh=t.automaticRefresh||!1,this.refreshTimeoutMs=t.refreshTimeoutMs||33e5}get authUrl(){return`https://auth.milkmantechnologies.com/${this.application}/login`}cognitoLogin(t,e){return fetch(this.authUrl,{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({ClientId:this.clientId,AuthFlow:c.USER_PASSWORD,AuthParameters:{USERNAME:t,PASSWORD:e}})})}cognitoRefresh(){return fetch(this.authUrl,{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({ClientId:this.clientId,AuthFlow:c.REFRESH_TOKEN,AuthParameters:{REFRESH_TOKEN:sessionStorage.getItem("MILMAN_COGNITO_REFRESH_TOKEN")}})})}scheduleAutomaticRefresh(){this.sessionTimeout&&s(this.sessionTimeout),this.sessionTimeout=setTimeout(()=>{this.refresh()},this.refreshTimeoutMs)}login(t,s){return e(this,void 0,void 0,(function*(){const{AuthenticationResult:e,error:o}=yield this.cognitoLogin(t,s).then(t=>t.json());if(o||!e)return Promise.reject(o);const{IdToken:r,RefreshToken:n}=e;var h;return i(r),h=n,sessionStorage.setItem("MILMAN_COGNITO_REFRESH_TOKEN",h),this.automaticRefresh&&this.scheduleAutomaticRefresh(),Promise.resolve(!0)}))}refresh(){return e(this,void 0,void 0,(function*(){const{AuthenticationResult:t,error:e}=yield this.cognitoRefresh().then(t=>t.json());if(e||!t)return Promise.reject(e);const{IdToken:s}=t;return i(s),this.automaticRefresh&&this.scheduleAutomaticRefresh(),Promise.resolve(!0)}))}}!function(t){t.EQ="$eq",t.NE="$ne",t.GT="$gt",t.GTE="$gte",t.LT="$le",t.LTE="$lte",t.IN="$in"}(a||(a={})),function(t){t[t.ASC=1]="ASC",t[t.DESC=0]="DESC"}(u||(u={}));const m=(t,e)=>{let s=0,i=[];for(;s<t.length;)i.push(t.slice(s,e)),s+=e;return i},f=(t,e)=>{t.forEach(t=>{t[e]})},p=t=>t.reduce((t,e)=>{t[e.id]=e},{}),O=(t,e)=>t[e],E=(t,e)=>e.map(e=>O(t,e));export{l as ApiAuth,r as ApiClient,a as ApiQueryRuleType,u as ApiSortValue,c as AuthenticationMethod,n as COGNITO_ENDPOINT,h as COGNITO_TOKEN_TIMEOUT,f as allIds,p as byId,m as chunks,o as defaultHeaders,O as selectId,E as selectIds};
//# sourceMappingURL=index.esm.min.js.map
