import{__rest as t,__awaiter as e}from"tslib";import"isomorphic-fetch";import{clearTimeout as s}from"timers";const r=t=>sessionStorage.setItem("MILMAN_COGNITO_ID_TOKEN",t),i={Accept:"application/json","Content-Type":"application/json"};class o{constructor(t={}){this.baseUrl=t.baseUrl}composeUrl(t){let e="";this.baseUrl&&(e+=this.baseUrl.replace(/\/*$/,""));return e+="/"+t.replace(/^\/*/,""),e}composeHeaders(t={}){return Object.assign(Object.assign(Object.assign({},i),{authorization:"Bearer "+sessionStorage.getItem("MILMAN_COGNITO_ID_TOKEN")}),t)}composeOptions(e,s={}){const{headers:r}=s,i=t(s,["headers"]);return Object.assign({method:e,headers:this.composeHeaders(r)},i)}fetch(t,e,s){return fetch(this.composeUrl(e),this.composeOptions(t,s))}get(t,e){this.fetch("GET",t,e)}post(t,e,s){this.fetch("POST",t,Object.assign({body:JSON.stringify(e)},s))}put(t,e,s){this.fetch("PUT",t,Object.assign({body:JSON.stringify(e)},s))}patch(t,e,s){this.fetch("PATCH",t,Object.assign({body:JSON.stringify(e)},s))}delete(t,e){this.fetch("DELETE",t,e)}}const n="https://auth.milkmantechnologies.com/",h=33e5;var c,u,a;!function(t){t.USER_PASSWORD="USER_PASSWORD_AUTH",t.REFRESH_TOKEN="REFRESH_TOKEN_AUTH"}(c||(c={}));class l{constructor(t){this.application=t.application,this.clientId=t.clientId,this.automaticRefresh=t.automaticRefresh||!1,this.refreshTimeoutMs=t.refreshTimeoutMs||33e5}get authUrl(){return`https://auth.milkmantechnologies.com/${this.application}/login`}cognitoLogin(t,e){return fetch(this.authUrl,{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({ClientId:this.clientId,AuthFlow:c.USER_PASSWORD,AuthParameters:{USERNAME:t,PASSWORD:e}})})}cognitoRefresh(){return fetch(this.authUrl,{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({ClientId:this.clientId,AuthFlow:c.REFRESH_TOKEN,AuthParameters:{REFRESH_TOKEN:sessionStorage.getItem("MILMAN_COGNITO_REFRESH_TOKEN")}})})}scheduleAutomaticRefresh(){this.sessionTimeout&&s(this.sessionTimeout),this.sessionTimeout=setTimeout(()=>{this.refresh()},this.refreshTimeoutMs)}login(t,s){return e(this,void 0,void 0,(function*(){const{AuthenticationResult:e,error:i}=yield this.cognitoLogin(t,s).then(t=>t.json());if(i||!e)return Promise.reject(i);const{IdToken:o,RefreshToken:n}=e;var h;return r(o),h=n,sessionStorage.setItem("MILMAN_COGNITO_REFRESH_TOKEN",h),this.automaticRefresh&&this.scheduleAutomaticRefresh(),Promise.resolve(!0)}))}refresh(){return e(this,void 0,void 0,(function*(){const{AuthenticationResult:t,error:e}=yield this.cognitoRefresh().then(t=>t.json());if(e||!t)return Promise.reject(e);const{IdToken:s}=t;return r(s),this.automaticRefresh&&this.scheduleAutomaticRefresh(),Promise.resolve(!0)}))}}!function(t){t.EQ="$eq",t.NE="$ne",t.GT="$gt",t.GTE="$gte",t.LT="$le",t.LTE="$lte",t.IN="$in"}(u||(u={}));class d{constructor(){this.query={}}addRule(t,e,s=""){return this.query.hasOwnProperty(t)||(this.query[t]={}),this.query[t][e]=s,this}removeRule(t,e){return this.query.hasOwnProperty(t)&&this.query[t].hasOwnProperty(e)&&(delete this.query[t][e],0===Object.keys(this.query[t]).length&&delete this.query[t]),this}eq(t,e){return this.addRule(t,u.EQ,e)}ne(t,e){return this.addRule(t,u.NE,e)}gt(t,e){return this.addRule(t,u.GT,e)}gte(t,e){return this.addRule(t,u.GTE,e)}lt(t,e){return this.addRule(t,u.LT,e)}lte(t,e){return this.addRule(t,u.LTE,e)}in(t,e){return this.addRule(t,u.IN,e)}toString(){return JSON.stringify(this.query)}}!function(t){t[t.ASC=1]="ASC",t[t.DESC=0]="DESC"}(a||(a={}));class m{constructor(){this.sort={}}addRule(t,e=a.ASC){return this.sort[t]=e,this}removeRule(t){return delete this.sort[t],this}asc(t){return this.addRule(t,a.ASC)}desc(t){return this.addRule(t,a.DESC)}toString(){return JSON.stringify(this.sort)}}const R=(t,e)=>{let s=0,r=[];for(;s<t.length;)r.push(t.slice(s,e)),s+=e;return r},f=(t,e)=>{t.forEach(t=>{t[e]})},p=t=>t.reduce((t,e)=>{t[e.id]=e},{}),O=(t,e)=>t[e],E=(t,e)=>e.map(e=>O(t,e));export{l as ApiAuth,o as ApiClient,d as ApiQuery,u as ApiQueryRuleType,m as ApiSort,a as ApiSortValue,c as AuthenticationMethod,n as COGNITO_ENDPOINT,h as COGNITO_TOKEN_TIMEOUT,f as allIds,p as byId,R as chunks,i as defaultHeaders,O as selectId,E as selectIds};
//# sourceMappingURL=index.esm.min.js.map
