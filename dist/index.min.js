"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib");require("isomorphic-fetch");var t=require("timers");const s=e=>sessionStorage.setItem("MILMAN_COGNITO_ID_TOKEN",e),r={Accept:"application/json","Content-Type":"application/json"};var i,o,h;exports.AuthenticationMethod=void 0,(i=exports.AuthenticationMethod||(exports.AuthenticationMethod={})).USER_PASSWORD="USER_PASSWORD_AUTH",i.REFRESH_TOKEN="REFRESH_TOKEN_AUTH";exports.ApiQueryRuleType=void 0,(o=exports.ApiQueryRuleType||(exports.ApiQueryRuleType={})).EQ="$eq",o.NE="$ne",o.GT="$gt",o.GTE="$gte",o.LT="$le",o.LTE="$lte",o.IN="$in";exports.ApiSortValue=void 0,(h=exports.ApiSortValue||(exports.ApiSortValue={}))[h.ASC=1]="ASC",h[h.DESC=0]="DESC";const n=(e,t)=>e[t];exports.ApiAuth=class{constructor(e){this.application=e.application,this.clientId=e.clientId,this.automaticRefresh=e.automaticRefresh||!1,this.refreshTimeoutMs=e.refreshTimeoutMs||33e5}get authUrl(){return`https://auth.milkmantechnologies.com/${this.application}/login`}cognitoLogin(e,t){return fetch(this.authUrl,{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({ClientId:this.clientId,AuthFlow:exports.AuthenticationMethod.USER_PASSWORD,AuthParameters:{USERNAME:e,PASSWORD:t}})})}cognitoRefresh(){return fetch(this.authUrl,{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({ClientId:this.clientId,AuthFlow:exports.AuthenticationMethod.REFRESH_TOKEN,AuthParameters:{REFRESH_TOKEN:sessionStorage.getItem("MILMAN_COGNITO_REFRESH_TOKEN")}})})}scheduleAutomaticRefresh(){this.sessionTimeout&&t.clearTimeout(this.sessionTimeout),this.sessionTimeout=setTimeout(()=>{this.refresh()},this.refreshTimeoutMs)}login(t,r){return e.__awaiter(this,void 0,void 0,(function*(){const{AuthenticationResult:e,error:i}=yield this.cognitoLogin(t,r).then(e=>e.json());if(i||!e)return Promise.reject(i);const{IdToken:o,RefreshToken:h}=e;var n;return s(o),n=h,sessionStorage.setItem("MILMAN_COGNITO_REFRESH_TOKEN",n),this.automaticRefresh&&this.scheduleAutomaticRefresh(),Promise.resolve(!0)}))}refresh(){return e.__awaiter(this,void 0,void 0,(function*(){const{AuthenticationResult:e,error:t}=yield this.cognitoRefresh().then(e=>e.json());if(t||!e)return Promise.reject(t);const{IdToken:r}=e;return s(r),this.automaticRefresh&&this.scheduleAutomaticRefresh(),Promise.resolve(!0)}))}},exports.ApiClient=class{constructor(e={}){this.baseUrl=e.baseUrl}composeUrl(e){let t="";this.baseUrl&&(t+=this.baseUrl.replace(/\/*$/,""));return t+="/"+e.replace(/^\/*/,""),t}composeHeaders(e={}){return Object.assign(Object.assign(Object.assign({},r),{authorization:"Bearer "+sessionStorage.getItem("MILMAN_COGNITO_ID_TOKEN")}),e)}composeOptions(t,s={}){const{headers:r}=s,i=e.__rest(s,["headers"]);return Object.assign({method:t,headers:this.composeHeaders(r)},i)}fetch(e,t,s){return fetch(this.composeUrl(t),this.composeOptions(e,s))}get(e,t){this.fetch("GET",e,t)}post(e,t,s){this.fetch("POST",e,Object.assign({body:JSON.stringify(t)},s))}put(e,t,s){this.fetch("PUT",e,Object.assign({body:JSON.stringify(t)},s))}patch(e,t,s){this.fetch("PATCH",e,Object.assign({body:JSON.stringify(t)},s))}delete(e,t){this.fetch("DELETE",e,t)}},exports.ApiQuery=class{constructor(){this.query={}}addRule(e,t,s=""){return this.query.hasOwnProperty(e)||(this.query[e]={}),this.query[e][t]=s,this}removeRule(e,t){return this.query.hasOwnProperty(e)&&this.query[e].hasOwnProperty(t)&&(delete this.query[e][t],0===Object.keys(this.query[e]).length&&delete this.query[e]),this}eq(e,t){return this.addRule(e,exports.ApiQueryRuleType.EQ,t)}ne(e,t){return this.addRule(e,exports.ApiQueryRuleType.NE,t)}gt(e,t){return this.addRule(e,exports.ApiQueryRuleType.GT,t)}gte(e,t){return this.addRule(e,exports.ApiQueryRuleType.GTE,t)}lt(e,t){return this.addRule(e,exports.ApiQueryRuleType.LT,t)}lte(e,t){return this.addRule(e,exports.ApiQueryRuleType.LTE,t)}in(e,t){return this.addRule(e,exports.ApiQueryRuleType.IN,t)}toString(){return JSON.stringify(this.query)}},exports.ApiSort=class{constructor(){this.sort={}}addRule(e,t=exports.ApiSortValue.ASC){return this.sort[e]=t,this}removeRule(e){return delete this.sort[e],this}asc(e){return this.addRule(e,exports.ApiSortValue.ASC)}desc(e){return this.addRule(e,exports.ApiSortValue.DESC)}toString(){return JSON.stringify(this.sort)}},exports.COGNITO_ENDPOINT="https://auth.milkmantechnologies.com/",exports.COGNITO_TOKEN_TIMEOUT=33e5,exports.allIds=(e,t)=>{e.forEach(e=>{e[t]})},exports.byId=e=>e.reduce((e,t)=>{e[t.id]=t},{}),exports.chunks=(e,t)=>{let s=0,r=[];for(;s<e.length;)r.push(e.slice(s,t)),s+=t;return r},exports.defaultHeaders=r,exports.selectId=n,exports.selectIds=(e,t)=>t.map(t=>n(e,t));
//# sourceMappingURL=index.min.js.map
