"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib");require("isomorphic-fetch");var t=require("timers");const s=e=>sessionStorage.setItem("MILMAN_COGNITO_ID_TOKEN",e),i={Accept:"application/json","Content-Type":"application/json"};var o,r,n;exports.AuthenticationMethod=void 0,(o=exports.AuthenticationMethod||(exports.AuthenticationMethod={})).USER_PASSWORD="USER_PASSWORD_AUTH",o.REFRESH_TOKEN="REFRESH_TOKEN_AUTH";exports.ApiQueryRuleType=void 0,(r=exports.ApiQueryRuleType||(exports.ApiQueryRuleType={})).EQ="$eq",r.NE="$ne",r.GT="$gt",r.GTE="$gte",r.LT="$le",r.LTE="$lte",r.IN="$in",exports.ApiSortValue=void 0,(n=exports.ApiSortValue||(exports.ApiSortValue={}))[n.ASC=1]="ASC",n[n.DESC=0]="DESC";const h=(e,t)=>e[t];exports.ApiAuth=class{constructor(e){this.application=e.application,this.clientId=e.clientId,this.automaticRefresh=e.automaticRefresh||!1,this.refreshTimeoutMs=e.refreshTimeoutMs||33e5}get authUrl(){return`https://auth.milkmantechnologies.com/${this.application}/login`}cognitoLogin(e,t){return fetch(this.authUrl,{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({ClientId:this.clientId,AuthFlow:exports.AuthenticationMethod.USER_PASSWORD,AuthParameters:{USERNAME:e,PASSWORD:t}})})}cognitoRefresh(){return fetch(this.authUrl,{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({ClientId:this.clientId,AuthFlow:exports.AuthenticationMethod.REFRESH_TOKEN,AuthParameters:{REFRESH_TOKEN:sessionStorage.getItem("MILMAN_COGNITO_REFRESH_TOKEN")}})})}scheduleAutomaticRefresh(){this.sessionTimeout&&t.clearTimeout(this.sessionTimeout),this.sessionTimeout=setTimeout(()=>{this.refresh()},this.refreshTimeoutMs)}login(t,i){return e.__awaiter(this,void 0,void 0,(function*(){const{AuthenticationResult:e,error:o}=yield this.cognitoLogin(t,i).then(e=>e.json());if(o||!e)return Promise.reject(o);const{IdToken:r,RefreshToken:n}=e;var h;return s(r),h=n,sessionStorage.setItem("MILMAN_COGNITO_REFRESH_TOKEN",h),this.automaticRefresh&&this.scheduleAutomaticRefresh(),Promise.resolve(!0)}))}refresh(){return e.__awaiter(this,void 0,void 0,(function*(){const{AuthenticationResult:e,error:t}=yield this.cognitoRefresh().then(e=>e.json());if(t||!e)return Promise.reject(t);const{IdToken:i}=e;return s(i),this.automaticRefresh&&this.scheduleAutomaticRefresh(),Promise.resolve(!0)}))}},exports.ApiClient=class{constructor(e={}){this.baseUrl=e.baseUrl}composeUrl(e){let t="";this.baseUrl&&(t+=this.baseUrl.replace(/\/*$/,""));return t+="/"+e.replace(/^\/*/,""),t}composeHeaders(e={}){return Object.assign(Object.assign(Object.assign({},i),{authorization:"Bearer "+sessionStorage.getItem("MILMAN_COGNITO_ID_TOKEN")}),e)}composeOptions(t,s={}){const{headers:i}=s,o=e.__rest(s,["headers"]);return Object.assign({method:t,headers:this.composeHeaders(i)},o)}fetch(e,t,s){return fetch(this.composeUrl(t),this.composeOptions(e,s))}get(e,t){this.fetch("GET",e,t)}post(e,t,s){this.fetch("POST",e,Object.assign({body:JSON.stringify(t)},s))}put(e,t,s){this.fetch("PUT",e,Object.assign({body:JSON.stringify(t)},s))}patch(e,t,s){this.fetch("PATCH",e,Object.assign({body:JSON.stringify(t)},s))}delete(e,t){this.fetch("DELETE",e,t)}},exports.COGNITO_ENDPOINT="https://auth.milkmantechnologies.com/",exports.COGNITO_TOKEN_TIMEOUT=33e5,exports.allIds=(e,t)=>{e.forEach(e=>{e[t]})},exports.byId=e=>e.reduce((e,t)=>{e[t.id]=t},{}),exports.chunks=(e,t)=>{let s=0,i=[];for(;s<e.length;)i.push(e.slice(s,t)),s+=t;return i},exports.defaultHeaders=i,exports.selectId=h,exports.selectIds=(e,t)=>t.map(t=>h(e,t));
//# sourceMappingURL=index.min.js.map
